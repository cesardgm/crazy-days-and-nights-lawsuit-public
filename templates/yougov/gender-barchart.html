<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<canvas id="gender-barchart"></canvas>
<script>
    // Replace the following lines with the actual lists from your data
    const row_numbers = {{ row_numbers | safe }};
    const density = {{ density | safe }};
    const male_running_ratio = {{ male_running_ratio | safe }};
    const female_running_ratio = {{ female_running_ratio | safe }};

    // Filter indices to only keep every 100th data point
    const filteredIndices = row_numbers.map((rn, i) => (i % 100 === 0 ? i : -1)).filter(i => i !== -1);

    // Create filtered data arrays for each attribute using the filtered indices
    const filteredRowNumbers = filteredIndices.map(i => row_numbers[i]);
    const filteredDensity = filteredIndices.map(i => density[i]);
    const filteredMaleRunningRatio = filteredIndices.map(i => male_running_ratio[i]);
    const filteredFemaleRunningRatio = filteredIndices.map(i => female_running_ratio[i]);

    // Calculate the male and female portions of each bar
    const malePortion = filteredMaleRunningRatio.map((ratio, i) => filteredDensity[i] * ratio);
    const femalePortion = filteredFemaleRunningRatio.map((ratio, i) => filteredDensity[i] * ratio);

    // Get the context of the canvas element to draw the chart
    const ctx = document.getElementById("gender-barchart").getContext("2d");

    // Create the Chart.js histogram object with the filtered data
    const histogram = new Chart(ctx, {
        type: "bar",
        data: {
            labels: filteredRowNumbers,
            datasets: [
                {
                    label: "Male Cum. Density",
                    data: malePortion,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: "rgba(0, 0, 0, 0.1)",
                    borderWidth: 1,
                    stack: "genderRatio"
                },
                {
                    label: "Female Cum. Density",
                    data: femalePortion,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: "rgba(0, 0, 0, 0.1)",
                    borderWidth: 1,
                    stack: "genderRatio"
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Cumulative Number of Celebrities'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Cumulative Density of Posts'
                    },
                    beginAtZero: true,
                    stacked: true
                }
            }
        }
    });
</script>